\section{Implementations-Sicht}


\subsection{Rendering des User Interfaces und Event-Behandlung}
Durch die Verwendung von \emph{barefoot} \cite{Barefoot} kann die komplette Beispielapplikation sowohl eigenständig auf dem Server gerendert werden, als auch als moderne JavaScript Applikation im Browser des Endbenutzers ausgeführt werden. Aus diesem Grund zeigen die folgenden zwei Abschnitte jeweils ein separates Sequenzdiagramm: Eines für das Event-Handling auf dem Client und eines für den Rendering-Vorgang auf dem Server.

Grundlegende Unterschiede gibt es hierbei lediglich beim Zugriff auf den \emph{APIAdapter}. Auf dem Server werden diese direkt lokal behandelt, im Client-Browser wird die entsprechende API-Abfrage über einen HTTP REST Request übertragen.

\subsubsection*{Server}
Beim initialen Aufruf der Beispielapplikation werden die kompletten Inhalte des User Interfaces auf dem Server gem. dem Diagramm \ref{dig:serverrendering} gerendert. Sollte der Client-Browser zudem JavaScript deaktiviert haben oder nicht unterstützen, so werden auch nachfolgende Requests nach dem gleichen Schema verarbeitet und gerendert.

\input{content/sad/diagrams/sequence-serverrendering}

\subsubsection*{Client}
Das Sequenzdiagramm \ref{dig:clientrendering} zeigt den Kontrollfluss nachdem der Benutzer im Browser auf einen Eintrag im Navigationsmenü geklickt hat.

Es gilt zu beachten dass die Aufrufe auf den \emph{APIAdapter} nicht lokal verarbeitet werden sondern direkt auf dem Server.

\input{content/sad/diagrams/sequence-clientrendering}


\subsection{APIAdapter}
Wie bereits erwähnt kann der \emph{APIAdapter} auf dem Server sowohl mit server-lokalen Requests als auch mit HTTP REST Anfragen umgehen.

Das Diagramm \ref{dig:apiAdapter} verdeutlicht die Abläufe im innern des Adapters für den jeweiligen Anfragemodus.

Hinter dem Element \emph{Controllers} stehen neben dem eigentlichen Controller zusätzlich diverse Sicherheitspolicies und Validatoren, welche eingehende Requests prüfen und ggf. abweisen können, bevor sie zur eigentlichen Geschäftslogik gelangen.

\input{content/sad/diagrams/sequence-apiadapter}


\subsection{Quellcode Organisation}
Auch für Applikationen für Node.JS ist üblich (\cite{TJH_ComponentStructure}, \cite{IZS_ComponentStructure}), den Quellcode soweit wie möglich in mehr oder weniger komplett eigenständige Komponenten zu unterteilen.

Ein gutes Beispiel hierfür sind die Vielzahl an verfügbaren Modulen welche über den Komponentenmanager NPM \cite{NPM} installierbar sind. Selbst Bibliotheken mit minimalem Umfang werden und sollten als eigene Module gekappselt werden.

Die Beispielapplikation ``Roomies'' folgt diesem Beispiel: Jede Komponente (Controllers, Policies usw.) ist abgetrennt von der eigentlichen Applikation. Sie werden erst zum Zeitpunkt der eigentlichen Initialisierung der Applikation eingebunden und konfiguriert.\\[0.5mm]

Der folgende Auszug aus der Ordnerstruktur veranschaulicht dieses Prinzip:
\begin{verbatim}
├── src
│   ├── lib
│   │   ├── community
│   │   │   └── views
│   │   │   └── controller.js
│   │   │   └── index.js
│   │   │   └── model.js
│   │   │   └── test.js
│   │   ├── facebook-channel
│   │   │   └── views
│   │   ├── home
│   │   │   └── views
│   │   ├── login
│   │   │   └── views
│   │   ├── middleware
│   │   ├── resident
│   │   │   └── views
│   │   ├── task
│   │   │   └── views
│   │   └── ...
│   ├── shared
│   │   ├── locales
│   │   ├── partials
│   │   ├── policies
│   │   ├── validators
│   │   └── ...
│   └── ...
└── ...
\end{verbatim}

Jede im Verzeichnis \emph{lib} enthaltene Komponente kann mit Node.JS über mittels einem \emph{require} Befehls eingebunden werden.

Dabei muss und sollte keine konkrete JavaScript Datei angegeben werden. Jede Komponente enthält eine \emph{index.js}-Datei, welche die Initialisierung der Komponente, aber auch die Repräsentation ``nach Aussen'' übernimmt.

\begin{lstlisting}[language=JavaScript, caption=Einbindung der Community-Komponenten]
// Requires actually ./lib/community/index.js:
var Community = require('./lib/community');
\end{lstlisting}
